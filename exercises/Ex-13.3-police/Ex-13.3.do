* Paul Johnson* 20160411* RHS exercise 13.3: police stops, data from Gelman and Hillcapture log closeset more off, permanentlylog using Ex-13.3.log, replace text* PJ: Am beginning to suspect I don't understand this data well.* Seems to me like "black" "hispanic" "white" should not be* predictors, only the proportion variables should be.  This is* a multivariate compositional problem.* use http://www.stata-press.com/data/mlmus3/police, clear* saveold police.dta12, version(12) replaceuse police.dta12, clearsumxtset precinctxtsum* 1 a.tabulate eth, generate(gr)rename gr1 blackrename gr2 hispanicrename gr3 whitekeep if crime==1poisson stops black hispanic, exposure(pop) vce(cluster precinct) irr* Note: same as offset(poplog)gen poplog = log(pop)poisson stops black hispanic, offset(poplog) vce(cluster precinct) irr* Compare non clustered modelpoisson stops black hispanic, offset(poplog) irr* 1 b.poisson stops black hispanic, exposure(arrests) vce(cluster precinct) irr* 2.poisson stops black hispanic prblack prhisp, exposure(arrests) ///   vce(cluster precinct) irr* 3. I'll show the "fe" estimator from xtpoisson is a fraud herequietly xtset precinctxtpoisson stops black hispanic, exposure(arrests) irr feestimates store xtpoisfepredict xtpoisfe, poisson stops black hispanic ibn.precinct, exposure(arrests) irr noconstestimates store poisdv* 4.xtmepoisson stops black hispanic prblack prhisp, exposure(arrests) irr ///   || precinct:,   estimates store xtmepois    display exp(sqrt(2*.4254449^2)*invnormal(3/4))* 5.* 6 a.* 6 b.xtmepoisson stops black hispanic prblack prhis, exposure(arrests) irr ///   || precinct: black hispanic, covariance(unstructured) * 6 c.predict inter slblack slhisp, reffectsegen pickone = tag(precinct)graph matrix inter slblack slhisp if pickone==1* meglm stops black hispanic prblack prhisp, offset(poplog) || precinct: , family(poisson)  irrestimates store meglmpois2est tab xtmepois meglmpois2,semeglm stops black hispanic, offset(poplog) || precinct: , family(poisson)  irrestimates store meglmpoisest tab xtmepois meglmpoismeglm stops black hispanic, offset(poplog) || precinct: , family(nbinomial)  irr